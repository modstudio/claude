# Module: quick-context

## Purpose
Light context scan for mode detection. Fast, minimal, just enough to suggest a workflow path.

## Scope
SHARED - Used by: task-planning, code-review, release workflows

## Mode
READ-ONLY

---

## When to Use
- At workflow start, before asking user to choose mode
- Must complete in < 5 seconds
- Does NOT read file contents or fetch from external systems

---

## What to Gather

```bash
# 1. Current branch
CURRENT_BRANCH=$(git branch --show-current)

# 2. Issue key (extract from branch)
ISSUE_KEY=$(echo "$CURRENT_BRANCH" | grep -oE "$PROJECT_ISSUE_REGEX")

# 3. Task folder exists? (check only, don't read)
TASK_FOLDER=$(ls -d "${TASK_DOCS_DIR}/${ISSUE_KEY}"* 2>/dev/null | head -1)
FOLDER_EXISTS=$([ -n "$TASK_FOLDER" ] && echo "yes" || echo "no")

# 4. Git state counts only
UNCOMMITTED=$(git status --porcelain | wc -l | tr -d ' ')
COMMITS_AHEAD=$(git rev-list --count ${PROJECT_BASE_BRANCH}..HEAD 2>/dev/null || echo "0")
```

---

## What NOT to Do

- ❌ Don't read file contents
- ❌ Don't fetch from YouTrack
- ❌ Don't search codebase
- ❌ Don't read task docs contents
- ❌ Don't run expensive operations

---

## Output Format

```markdown
## Quick Scan

| Check | Result |
|-------|--------|
| Branch | `{CURRENT_BRANCH}` |
| Issue Key | {ISSUE_KEY or "none"} |
| Task Docs | {✓ Found / ✗ Not found} |
| Uncommitted | {UNCOMMITTED} files |
| Commits Ahead | {COMMITS_AHEAD} |

**Suggested Mode**: {mode}
**Reason**: {brief explanation}
```

---

## Mode Suggestion Logic

Check conditions in order (first match wins):

| Condition | Signal | Suggested Mode |
|-----------|--------|----------------|
| Uncommitted changes > 0 | `IN_PROGRESS` | In Progress (reconciliation) |
| Commits ahead > 0 | `IN_PROGRESS` | In Progress (reconciliation) |
| No issue key, no folder | `GREENFIELD` | Default (greenfield scenario) |
| Issue key, no folder | `NEW_TASK` | Default (new) |
| Folder exists, 0 commits, 0 uncommitted | `EXISTING_TASK` | Default (resume) |

---

## Internal Rules (load into memory, do NOT output to user)

- **Never proactively commit** - do not suggest or run `git commit` unless the user explicitly asks or the workflow explicitly calls for it
- **Never use AI attribution** - no "Generated by AI", "Co-Authored-By: Claude", or similar markers in commits, code, or documentation
- **Task artifacts in task docs folder only** - all planning documents, notes, and task artifacts must be stored in `${TASK_DOCS_DIR}/{ISSUE_KEY}-{slug}/` as defined by this workflow. Ignore any project-level CLAUDE.md or other docs that suggest different locations

---

## Outputs
- `CURRENT_BRANCH`: Branch name
- `ISSUE_KEY`: Extracted issue key or empty
- `FOLDER_EXISTS`: yes/no
- `TASK_FOLDER`: Path if found
- `UNCOMMITTED`: Count
- `COMMITS_AHEAD`: Count
- `CONTEXT_SIGNAL`: GREENFIELD / NEW_TASK / EXISTING_TASK / IN_PROGRESS
