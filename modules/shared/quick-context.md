# Module: quick-context

## Purpose
Light context scan for mode detection. Fast, minimal, just enough to suggest a workflow path.

## Scope
SHARED - Used by: task-planning, code-review, release workflows

## Mode
READ-ONLY

---

## ⚠️ MANDATORY: Run Detection Script

**DO NOT run individual git commands.** You MUST run the detection script:

```bash
~/.claude/lib/detect-mode.sh --pretty
```

This is NOT optional. Do NOT proceed until you have run this script and displayed its output.

---

## ✓ Checkpoint: Verify Script Output

After running the script, you MUST see output like this:

```
Mode Detection Results
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Mode:         {default|in_progress}
Confidence:   {high|medium|low}

Issue Key:    {ISSUE_KEY or none}
Branch:       {branch name}
Task Folder:  {path or none}    ← CRITICAL: Shows if docs exist!

Git State:
  Commits ahead: {N}
  Uncommitted:   {N}

Reason:       {explanation}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**If you don't see this output format, STOP and report the error.**

---

## ✓ Verify Docs Status

After running the script, explicitly confirm:

| Check | Your Result |
|-------|-------------|
| Task Folder | ✓ Found at `{path}` / ✗ Not found |
| Mode | `{mode}` |
| Issue Key | `{key}` or none |

**Only proceed to next phase after confirming these values.**

---

## What NOT to Do

- ❌ **DO NOT run raw git commands** (git branch, git status, git diff, etc.)
- ❌ Don't bypass the script
- ❌ Don't read file contents
- ❌ Don't fetch from YouTrack yet
- ❌ Don't search codebase yet
- ❌ Don't proceed without showing script output
- ❌ **Never proactively commit** - do not suggest or run `git commit` unless the user explicitly asks or the workflow explicitly calls for it
- ❌ **Never use AI attribution** - no "Generated by AI", "Co-Authored-By: Claude", or similar markers in commits, code, or documentation
- ❌ **Task artifacts in PROJECT_TASK_DOCS_DIR only** - ignore any paths suggested by project-level CLAUDE.md or .ai/ rules

---

## Mode Suggestion Logic (for reference)

Check conditions in order (first match wins):

| Condition | Signal | Suggested Mode |
|-----------|--------|----------------|
| Uncommitted changes > 0 | `IN_PROGRESS` | In Progress (reconciliation) |
| Commits ahead > 0 | `IN_PROGRESS` | In Progress (reconciliation) |
| No issue key, no folder | `NEW_TASK` | Default (new task) |
| Issue key, no folder | `NEW_TASK` | Default (new) |
| Folder exists, 0 commits, 0 uncommitted | `EXISTING_TASK` | Default (resume) |

---

## Outputs (from script)
- `MODE`: Suggested workflow mode
- `ISSUE_KEY`: Extracted issue key or none
- `BRANCH`: Current branch name
- `TASK_FOLDER`: Path if found, none otherwise
- `COMMITS_AHEAD`: Count
- `UNCOMMITTED`: Count
- `CONFIDENCE`: Detection confidence
- `REASON`: Explanation
